<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Happy Valentine üíó</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
html,body{margin:0;height:100%;background:#000;font-family:"Press Start 2P"}
.wrap{position:relative;width:100vw;height:100vh;overflow:hidden}
canvas{display:block;width:100%;height:100%;image-rendering:pixelated}
.chip{
position:absolute;
right:16px;
bottom:80px;
background:rgba(0,0,0,.35);
padding:12px;
border-radius:14px;
}
button{
font-family:"Press Start 2P";
font-size:10px;
background:#fff2fb;
border:2px solid #000;
border-radius:10px;
padding:10px;
cursor:pointer;
}
.sig{
position:absolute;
left:50%;
transform:translateX(-50%);
bottom:20px;
color:#fff;
font-size:12px;
text-shadow:2px 2px 0 #000;
}
</style>
</head>

<body>
<div class="wrap">
<canvas id="c"></canvas>

<div class="chip">
<button id="muteBtn">Mute</button>
</div>

<div class="sig">I love you, Dimi üíê</div>

<audio id="bgm" loop>
<source src="AUD-20210820-WA0076.mp3" type="audio/mpeg">
</audio>

<script>
(()=>{

const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
ctx.imageSmoothingEnabled=false;

function resize(){
const dpr=window.devicePixelRatio||1;
canvas.width=window.innerWidth*dpr;
canvas.height=window.innerHeight*dpr;
ctx.setTransform(1,0,0,1,0,0);
ctx.scale(dpr,dpr);
}
window.addEventListener("resize",resize);
resize();

const bgm=document.getElementById("bgm");
let muted=false;

const AC=new (window.AudioContext||window.webkitAudioContext)();
function chime(){
if(muted)return;
const now=AC.currentTime;
const o=AC.createOscillator();
const g=AC.createGain();
o.type="triangle";
o.frequency.setValueAtTime(700,now);
o.frequency.exponentialRampToValueAtTime(1100,now+.1);
g.gain.setValueAtTime(.0001,now);
g.gain.exponentialRampToValueAtTime(.15,now+.02);
g.gain.exponentialRampToValueAtTime(.0001,now+.18);
o.connect(g).connect(AC.destination);
o.start();o.stop(now+.2);
}

document.getElementById("muteBtn").onclick=()=>{
muted=!muted;
bgm.muted=muted;
document.getElementById("muteBtn").textContent=muted?"Unmute":"Mute";
};

async function tryPlay(){
try{await bgm.play();}catch(e){}
}

const messages=[
"I'm so proud of you.",
"You are my sunshine.",
"You are the best girlfriend.",
"You make my days brighter.",
"You are so strong.",
"You are so kind.",
"You inspire me.",
"I love your smile.",
"You mean everything to me."
];
let msgIndex=0;
let skyText="Tap anywhere to drop cheese üßÄ";
let skyTimer=200;
let sparkleTimer=0;

function showMsg(t){
skyText=t;
skyTimer=260;
sparkleTimer=70;
}

function ir(a,b){return Math.floor(Math.random()*(b-a+1))+a}
function horizon(H){return H*.4}

function flower(x,y,color){
ctx.fillStyle="#2fbf4b";
ctx.fillRect(x+10,y+25,4,28);
ctx.fillStyle=color;
ctx.fillRect(x+5,y+10,20,14);
ctx.fillStyle="#ffd24a";
ctx.fillRect(x+13,y+15,4,4);
}

function cheese(x,y){
ctx.fillStyle="#ffdb58";
ctx.beginPath();
ctx.moveTo(x,y);
ctx.lineTo(x+24,y+6);
ctx.lineTo(x,y+18);
ctx.closePath();
ctx.fill();
ctx.fillStyle="#e5b83d";
ctx.fillRect(x+6,y+6,3,3);
ctx.fillRect(x+12,y+8,3,3);
ctx.fillRect(x+7,y+12,3,3);
}

function rat(x,y){
ctx.fillStyle="#bbb";
ctx.fillRect(x,y,18,10);
ctx.fillRect(x+10,y-6,12,12);
ctx.fillStyle="#ff5aa5";
ctx.fillRect(x+16,y-8,4,4);
ctx.fillStyle="#000";
ctx.fillRect(x+18,y-2,2,2);
}

function drawArcTitle(text,W){
ctx.save();
ctx.font="16px 'Press Start 2P'";
ctx.textAlign="center";
ctx.textBaseline="middle";

const chars=text.split("");
const total=chars.length;
const radius=Math.min(220,W*.45);
const start=Math.PI*1.1;
const end=Math.PI*1.9;
const step=(end-start)/(total-1);

for(let i=0;i<total;i++){
const wave=Math.sin(Date.now()/400+i*.5)*4;
const a=start+step*i;
const x=W/2+Math.cos(a)*radius;
const y=70+Math.sin(a)*radius/1.8+wave;
ctx.save();
ctx.translate(x,y);
ctx.rotate(a+Math.PI/2);
ctx.fillStyle="#ff4fa3";
ctx.fillText(chars[i],0,0);
ctx.restore();
}
ctx.restore();
}

let flowers=[];
let cheeseObj=null;
let ratX=80;
let ratY=0;
let target=null;

function dropCheese(x,y){
if(y<horizon(window.innerHeight))return;
cheeseObj={x:x-10,y:y-10};
target={x:cheeseObj.x,y:cheeseObj.y};
showMsg("Cheese spotted! üßÄ");
chime();
}

canvas.addEventListener("pointerdown",(e)=>{
tryPlay();
chime();
const rect=canvas.getBoundingClientRect();
dropCheese(e.clientX-rect.left,e.clientY-rect.top);
});

function update(){
if(target){
const dx=target.x-ratX;
const dy=target.y-ratY;
const d=Math.hypot(dx,dy);
if(d<3){
flowers.push({x:cheeseObj.x-6,y:cheeseObj.y-40,color:["#ff5aa5","#ffd24a","#7fd6ff"][ir(0,2)]});
cheeseObj=null;
target=null;
showMsg(messages[msgIndex%messages.length]);
msgIndex++;
}else{
ratX+=dx*.02;
ratY+=dy*.02;
}
}
}

function draw(){
const W=window.innerWidth;
const H=window.innerHeight;
const h=horizon(H);

const g=ctx.createLinearGradient(0,0,0,H);
g.addColorStop(0,"#79b7ff");
g.addColorStop(1,"#bfe6ff");
ctx.fillStyle=g;
ctx.fillRect(0,0,W,H);

ctx.fillStyle="#fff";
ctx.fillRect(40+Math.sin(Date.now()/800)*20,80,40,20);

ctx.fillStyle="#155f28";
ctx.fillRect(0,h,W,H-h);

flowers.forEach(f=>flower(f.x,f.y,f.color));
if(cheeseObj)cheese(cheeseObj.x,cheeseObj.y);
rat(ratX,ratY);

drawArcTitle("Happy Valentine‚Äôs Day My bby üíó",W);

if(skyTimer>0)skyTimer--;

ctx.font="14px 'Press Start 2P'";
ctx.textAlign="center";
ctx.fillStyle="rgba(27,21,48,.6)";
ctx.fillRect(W/2-250,110,500,60);
ctx.fillStyle="#fff";
ctx.fillText(skyText,W/2,140);

update();
requestAnimationFrame(draw);
}

draw();

})();
</script>
</div>
</body>
</html>
